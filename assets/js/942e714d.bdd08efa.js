"use strict";(self.webpackChunktracetest_docs=self.webpackChunktracetest_docs||[]).push([[5595],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=l(n),m=r,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(f,i(i({ref:t},p),{},{components:n})):a.createElement(f,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},468:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const o={},i="Elastic APM",c={unversionedId:"configuration/connecting-to-data-stores/elasticapm",id:"configuration/connecting-to-data-stores/elasticapm",title:"Elastic APM",description:"If you want to use Elastic APM as the trace data store, you can configure Tracetest to fetch trace data from Elasticsearch.",source:"@site/docs/configuration/connecting-to-data-stores/elasticapm.md",sourceDirName:"configuration/connecting-to-data-stores",slug:"/configuration/connecting-to-data-stores/elasticapm",permalink:"/configuration/connecting-to-data-stores/elasticapm",draft:!1,editUrl:"https://github.com/kubeshop/tracetest/blob/main/docs/docs/configuration/connecting-to-data-stores/elasticapm.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OpenSearch",permalink:"/configuration/connecting-to-data-stores/opensearch"},next:{title:"SignalFx",permalink:"/configuration/connecting-to-data-stores/signalfx"}},s={},l=[{value:"Configure OpenTelemetry Collector to Send Traces to Elastic APM",id:"configure-opentelemetry-collector-to-send-traces-to-elastic-apm",level:2},{value:"Configure Tracetest to Use Elastic APM as a Trace Data Store",id:"configure-tracetest-to-use-elastic-apm-as-a-trace-data-store",level:2},{value:"Web UI",id:"web-ui",level:3},{value:"CLI",id:"cli",level:3}],p={toc:l};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"elastic-apm"},"Elastic APM"),(0,r.kt)("p",null,"If you want to use Elastic APM as the trace data store, you can configure Tracetest to fetch trace data from Elasticsearch."),(0,r.kt)("p",null,"You'll configure the OpenTelemetry Collector to receive traces from your system and then send them to Elasticsearch via Elastic APM. And, you don't have to change your existing pipelines to do so."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Examples of configuring Tracetest can be found in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubeshop/tracetest/tree/main/examples"},(0,r.kt)("inlineCode",{parentName:"a"},"examples")," folder of the Tracetest GitHub repo"),". ")),(0,r.kt)("h2",{id:"configure-opentelemetry-collector-to-send-traces-to-elastic-apm"},"Configure OpenTelemetry Collector to Send Traces to Elastic APM"),(0,r.kt)("p",null,"In your OpenTelemetry Collector config file, make sure to set the ",(0,r.kt)("inlineCode",{parentName:"p"},"exporter")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"otlp"),", with the ",(0,r.kt)("inlineCode",{parentName:"p"},"endpoint")," pointing to the Elastic APM server on port ",(0,r.kt)("inlineCode",{parentName:"p"},"8200"),". If you are running Tracetest with Docker, the endpoint might look like this ",(0,r.kt)("inlineCode",{parentName:"p"},"apm-server:8200"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# collector.config.yaml\n\n# If you already have receivers declared, you can just ignore\n# this one and use yours instead.\nreceivers:\n  otlp:\n    protocols:\n      grpc:\n      http:\n\nprocessors:\n  batch:\n    timeout: 100ms\n\nexporters:\n  otlp/elastic:\n    endpoint: apm-server:8200\n    tls:\n      insecure: true\n      insecure_skip_verify: true\n\nservice:\n  pipelines:\n    # You probably already have a traces pipeline, you don't have to change it.\n    # Just add this one to your configuration. Just make sure to not have two\n    # pipelines with the same name.\n    traces/1:\n      receivers: [otlp] # your receiver\n      processors: [batch] # make sure to add the batch processor\n      exporters: [otlp/elastic] # your exporter pointing to your Elastic APM server instance\n\n")),(0,r.kt)("h2",{id:"configure-tracetest-to-use-elastic-apm-as-a-trace-data-store"},"Configure Tracetest to Use Elastic APM as a Trace Data Store"),(0,r.kt)("p",null,"You also have to configure your Tracetest instance to make it aware that it has to fetch trace data from Elastic APM. "),(0,r.kt)("p",null,"Make sure you know which Index name, Address, and credentials you are using. In the screenshot below, the Index name is ",(0,r.kt)("inlineCode",{parentName:"p"},"traces-apm-default"),", the Address is ",(0,r.kt)("inlineCode",{parentName:"p"},"https://es01:9200"),", and the Username and Password are to set to ",(0,r.kt)("inlineCode",{parentName:"p"},"elastic")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"changeme"),"."),(0,r.kt)("p",null,'To configure Elastic APM you will need to download the CA certificate from the docker image and upload it to the config under "Upload CA file".'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The command to download the ",(0,r.kt)("inlineCode",{parentName:"li"},"ca.crt")," file is:\n",(0,r.kt)("inlineCode",{parentName:"li"},"docker cp tracetest-elasticapm-with-elastic-agent-es01-1:/usr/share/elasticsearch/config/certs/ca/ca.crt .")),(0,r.kt)("li",{parentName:"ul"},"Alternatively, you can skip CA certificate validation by setting the ",(0,r.kt)("inlineCode",{parentName:"li"},"Enable TLS but don't verify the certificate")," option.")),(0,r.kt)("h3",{id:"web-ui"},"Web UI"),(0,r.kt)("p",null,"In the Web UI, open settings, and select Elastic APM."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://res.cloudinary.com/djwdcmwdz/image/upload/v1674566041/Blogposts/Docs/screely-1674566018046_ci0st9.png",alt:null})),(0,r.kt)("h3",{id:"cli"},"CLI"),(0,r.kt)("p",null,"Or, if you prefer using the CLI, you can use this file config."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"type: DataStore\nspec:\n  name: Elastic Data Store\n  type: elasticapm\n  isDefault: true\n    elasticapm:\n      addresses:\n        - https://es01:9200\n      username: elastic\n      password: changeme\n      index: traces-apm-default\n      insecureSkipVerify: true\n")),(0,r.kt)("p",null,"Proceed to run this command in the terminal, and specify the file above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"tracetest datastore apply -f my/data-store/file/location.yaml\n")))}u.isMDXComponent=!0}}]);